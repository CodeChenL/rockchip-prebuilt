#!/usr/bin/env bash
#
# Rockchip begins to include adbd in rktoolkit, which is newer than
# android-tools-adbd we got from Debian Buster.
#
# However, the Debian 11 SDK contains the same package with the same version,
# so using its own name as dependency can break adbd related functionality.
#
# Add a virtual package for dependency.
#

SCRIPT_DIR="$(dirname "$(realpath "$0")")"
source "$SCRIPT_DIR/libfixup.sh"

fixup_callback() {
    extract data.tar usr/lib/chromium/chromium-bin
    patchelf --replace-needed libmali.so.1 libgbm.so.1 usr/lib/chromium/chromium-bin
    replace data.tar usr/lib/chromium/chromium-bin
    rm -rf usr/
}

fixup_loop "$@"
